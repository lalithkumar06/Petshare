{"ast":null,"code":"import _objectSpread from\"C:/Users/DELL/Desktop/project/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState}from'react';import{Dialog,DialogTitle,DialogContent,DialogActions,TextField,Button,MenuItem,Box,Typography}from'@mui/material';import{pets}from'../utils/api';import{useAuth}from'../contexts/AuthContext';import{toast}from'react-toastify';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const petTypes=[{value:'dog',label:'Dog'},{value:'cat',label:'Cat'},{value:'bird',label:'Bird'},{value:'other',label:'Other'}];export default function PostPetModal(_ref){let{open,onClose}=_ref;const{user}=useAuth();const[form,setForm]=useState({name:'',type:'',breed:'',age:'',description:'',image:null});const[loading,setLoading]=useState(false);const handleChange=e=>{const{name,value,files}=e.target;setForm(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:files?files[0]:value}));};const handleSubmit=async e=>{e.preventDefault();const token=localStorage.getItem('token');console.debug('PostPetModal submit, token:',token);if(!user||!token){toast.error('You must be logged in to post a pet.');return;}if(!form.name||!form.type||!form.breed||!form.age||!form.description||!form.image){toast.error('Please fill all fields and select an image.');return;}setLoading(true);try{const data=new FormData();Object.entries(form).forEach(_ref2=>{let[k,v]=_ref2;return data.append(k,v);});await pets.create(data);toast.success('Pet posted successfully!');onClose();}catch(err){console.error('Post pet error:',err);// Prefer server JSON message when available (our server now returns JSON errors)\nconst serverMessage=err&&err.response&&err.response.data&&(typeof err.response.data==='object'?err.response.data.message:null);if(err.response&&err.response.status===401){toast.error(serverMessage||'Authentication failed — please login again.');}else if(err.response&&err.response.status===400){toast.error(serverMessage||'Bad request — please check your input.');}else if(serverMessage){toast.error(serverMessage);}else{toast.error('Failed to post pet.');}}finally{setLoading(false);}};return/*#__PURE__*/_jsxs(Dialog,{open:open,onClose:onClose,maxWidth:\"sm\",fullWidth:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Post a New Pet\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsxs(Box,{component:\"form\",sx:{mt:1},children:[/*#__PURE__*/_jsx(TextField,{label:\"Name\",name:\"name\",value:form.name,onChange:handleChange,fullWidth:true,margin:\"normal\",required:true}),/*#__PURE__*/_jsx(TextField,{select:true,label:\"Type\",name:\"type\",value:form.type,onChange:handleChange,fullWidth:true,margin:\"normal\",required:true,children:petTypes.map(option=>/*#__PURE__*/_jsx(MenuItem,{value:option.value,children:option.label},option.value))}),/*#__PURE__*/_jsx(TextField,{label:\"Breed\",name:\"breed\",value:form.breed,onChange:handleChange,fullWidth:true,margin:\"normal\",required:true}),/*#__PURE__*/_jsx(TextField,{label:\"Age\",name:\"age\",value:form.age,onChange:handleChange,type:\"number\",fullWidth:true,margin:\"normal\",required:true}),/*#__PURE__*/_jsx(TextField,{label:\"Description\",name:\"description\",value:form.description,onChange:handleChange,fullWidth:true,margin:\"normal\",multiline:true,rows:3,required:true}),/*#__PURE__*/_jsxs(Button,{variant:\"contained\",component:\"label\",sx:{mt:2},children:[\"Upload Image\",/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"image\",accept:\"image/*\",hidden:true,onChange:handleChange})]}),form.image&&/*#__PURE__*/_jsx(Typography,{sx:{mt:1},children:form.image.name})]})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:onClose,color:\"secondary\",children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{onClick:handleSubmit,color:\"primary\",variant:\"contained\",disabled:loading,children:loading?'Posting...':'Post Pet'})]})]});}","map":{"version":3,"names":["React","useState","Dialog","DialogTitle","DialogContent","DialogActions","TextField","Button","MenuItem","Box","Typography","pets","useAuth","toast","jsx","_jsx","jsxs","_jsxs","petTypes","value","label","PostPetModal","_ref","open","onClose","user","form","setForm","name","type","breed","age","description","image","loading","setLoading","handleChange","e","files","target","prev","_objectSpread","handleSubmit","preventDefault","token","localStorage","getItem","console","debug","error","data","FormData","Object","entries","forEach","_ref2","k","v","append","create","success","err","serverMessage","response","message","status","maxWidth","fullWidth","children","component","sx","mt","onChange","margin","required","select","map","option","multiline","rows","variant","accept","hidden","onClick","color","disabled"],"sources":["C:/Users/DELL/Desktop/project/client/src/components/PostPetModal.js"],"sourcesContent":["import React, { useState } from 'react';\r\nimport {\r\n  Dialog, DialogTitle, DialogContent, DialogActions,\r\n  TextField, Button, MenuItem, Box, Typography\r\n} from '@mui/material';\r\nimport { pets } from '../utils/api';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { toast } from 'react-toastify';\r\n\r\nconst petTypes = [\r\n  { value: 'dog', label: 'Dog' },\r\n  { value: 'cat', label: 'Cat' },\r\n  { value: 'bird', label: 'Bird' },\r\n  { value: 'other', label: 'Other' },\r\n];\r\n\r\nexport default function PostPetModal({ open, onClose }) {\r\n  const { user } = useAuth();\r\n  const [form, setForm] = useState({\r\n    name: '',\r\n    type: '',\r\n    breed: '',\r\n    age: '',\r\n    description: '',\r\n    image: null,\r\n  });\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const handleChange = (e) => {\r\n    const { name, value, files } = e.target;\r\n    setForm((prev) => ({\r\n      ...prev,\r\n      [name]: files ? files[0] : value,\r\n    }));\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    const token = localStorage.getItem('token');\r\n    console.debug('PostPetModal submit, token:', token);\r\n    if (!user || !token) {\r\n      toast.error('You must be logged in to post a pet.');\r\n      return;\r\n    }\r\n    if (!form.name || !form.type || !form.breed || !form.age || !form.description || !form.image) {\r\n      toast.error('Please fill all fields and select an image.');\r\n      return;\r\n    }\r\n    setLoading(true);\r\n    try {\r\n      const data = new FormData();\r\n      Object.entries(form).forEach(([k, v]) => data.append(k, v));\r\n      await pets.create(data);\r\n      toast.success('Pet posted successfully!');\r\n      onClose();\r\n    } catch (err) {\r\n      console.error('Post pet error:', err);\r\n      // Prefer server JSON message when available (our server now returns JSON errors)\r\n      const serverMessage = err && err.response && err.response.data && (typeof err.response.data === 'object' ? err.response.data.message : null);\r\n      if (err.response && err.response.status === 401) {\r\n        toast.error(serverMessage || 'Authentication failed — please login again.');\r\n      } else if (err.response && err.response.status === 400) {\r\n        toast.error(serverMessage || 'Bad request — please check your input.');\r\n      } else if (serverMessage) {\r\n        toast.error(serverMessage);\r\n      } else {\r\n        toast.error('Failed to post pet.');\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onClose={onClose} maxWidth=\"sm\" fullWidth>\r\n      <DialogTitle>Post a New Pet</DialogTitle>\r\n      <DialogContent>\r\n        <Box component=\"form\" sx={{ mt: 1 }}>\r\n          <TextField label=\"Name\" name=\"name\" value={form.name} onChange={handleChange} fullWidth margin=\"normal\" required />\r\n          <TextField select label=\"Type\" name=\"type\" value={form.type} onChange={handleChange} fullWidth margin=\"normal\" required>\r\n            {petTypes.map((option) => (\r\n              <MenuItem key={option.value} value={option.value}>{option.label}</MenuItem>\r\n            ))}\r\n          </TextField>\r\n          <TextField label=\"Breed\" name=\"breed\" value={form.breed} onChange={handleChange} fullWidth margin=\"normal\" required />\r\n          <TextField label=\"Age\" name=\"age\" value={form.age} onChange={handleChange} type=\"number\" fullWidth margin=\"normal\" required />\r\n          <TextField label=\"Description\" name=\"description\" value={form.description} onChange={handleChange} fullWidth margin=\"normal\" multiline rows={3} required />\r\n          <Button variant=\"contained\" component=\"label\" sx={{ mt: 2 }}>\r\n            Upload Image\r\n            <input type=\"file\" name=\"image\" accept=\"image/*\" hidden onChange={handleChange} />\r\n          </Button>\r\n          {form.image && <Typography sx={{ mt: 1 }}>{form.image.name}</Typography>}\r\n        </Box>\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={onClose} color=\"secondary\">Cancel</Button>\r\n        <Button onClick={handleSubmit} color=\"primary\" variant=\"contained\" disabled={loading}>{loading ? 'Posting...' : 'Post Pet'}</Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}